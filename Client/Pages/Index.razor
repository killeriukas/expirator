@page "/"
@using Shared.Dtos

<div class="row">
    <a class="btn btn-success my-4 px-5" href="/eventdata/add">Add</a>
</div>
<div class="row">
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Start Time</th>
                <th>Expiration Time</th>
                <th>Due</th>
            </tr>
        </thead>
        <tbody>
            @foreach(var data in eventViews) {
                <tr class="@data.dueInDaysColorClass text-white">
                    <td>@data.Name</td>
                    <td>@data.StartTime.ToShortDateString()</td>
                    <td>@data.ExpirationTime.ToShortDateString()</td>
                    <td><span>@data.dueInDays Days</span></td>
                </tr>
            }
        </tbody>
    </table>
</div>


@code {

    private int index = 0;

    private List<EventView> eventViews = null;

    private class EventView : EventDataReadDto {
        public int dueInDays => (int)ExpirationTime.Subtract(StartTime).TotalDays;
        public string dueInDaysColorClass {
            get {
                if(dueInDays > 30) {
                    return "bg-success";
                } else if(dueInDays > 7) {
                    return "bg-warning";
                } else {
                    return "bg-danger";
                }
            }
        }
    }

    protected override void OnInitialized() {

        eventViews = new List<EventView>() {
                new EventView() {
                    Id = index++,
                    Name = "Test Name 0",
                    StartTime = DateTime.UtcNow,
                    ExpirationTime = DateTime.UtcNow.AddDays(5)
                            },
                new EventView() {
                    Id = index++,
                    Name = "Test Name 1",
                    StartTime = DateTime.UtcNow,
                    ExpirationTime = DateTime.UtcNow.AddDays(7)
                            },
                new EventView() {
                    Id = index++,
                    Name = "Test Name 2",
                    StartTime = DateTime.UtcNow,
                    ExpirationTime = DateTime.UtcNow.AddDays(15)
                            },
                new EventView() {
                    Id = index++,
                    Name = "Test Name 3",
                    StartTime = DateTime.UtcNow,
                    ExpirationTime = DateTime.UtcNow.AddDays(45)
                            },
            };
    }


    private void OnAddButtonClicked() {
        Console.WriteLine("testing, what's going on!");
    }

}